!(function (e, t) {
  "function" == typeof define && define.amd
    ? define([], t(e))
    : "object" == typeof exports
    ? (module.exports = t(e))
    : (e.baniPlugin = t(e));
})(
  "undefined" != typeof global ? global : this.window || this.global,
  function (e) {
    "use strict";
    var t = {},
      n = !!document.querySelector && !!e.addEventListener;
    let o, a, i;
    var l,
      r = null;
    const d = (e) => {
        for (
          var t = "",
            n =
              "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
            o = 0;
          o < e;
          o++
        )
          t += n.charAt(Math.floor(62 * Math.random()));
        return t;
      },
      s = document?.body,
      c = document?.head,
      p = "app-frame-" + d(6),
      u = "app-loader-" + d(6),
      m = "app-spinner-" + d(6),
      y = "app-spinner-style" + d(6);
    function h() {
      const e = document.getElementById(p);
      e && document.body.removeChild(e);
    }
    t.destroy = function () {
      document.getElementById(p) && h(), (l = null);
    };
    const f = (e) => {
      let t = e?.data?.type || e?.data,
        n = e?.data?.response;
      switch (t) {
        case "CHECKOUTREADY":
          (() => {
            const e = document.getElementById(u);
            e && (e.style.opacity = "0");
          })(),
            (() => {
              const e = document.getElementById(u);
              e && document.body.removeChild(e);
            })(),
            (() => {
              const e = document.getElementById(m),
                t = document.head.querySelector(`style#${y}`);
              e && document.body.removeChild(e), t && c.removeChild(t);
            })();
          break;
        case "CHECKOUTCLOSE":
          h();
          break;
        case "ONCLOSE":
          h(), o && o({ ...n });
          break;
        case "CALLBACK":
          a && a({ ...n });
        case "CUSTOMER_EXISTS":
          i && i({ ...n });
      }
    };
    return (
      (t.init = function (e) {
        if (!n) return;
        var h;
        t.destroy(),
          (h = ((e) => {
            const t = e?.merchantKey?.includes("test")
                ? "https://stage-checkout.getbani.com/"
                : "https://live-checkout.getbani.com/",
              n = document.createElement("iframe");
            return (
              [
                { key: "src", val: t },
                {
                  key: "style",
                  val: "z-index: 9999999999; background: transparent; border: 0px none transparent; overflow: hidden; margin: 0px; padding: 0px; -webkit-tap-highlight-color: transparent; position: fixed; left: 0px; top: 0px; width: 100%; visibility: visible; height: 100%; display:block;",
                },
                { key: "id", val: p },
                { key: "allowfullscreen", val: "true" },
                { key: "allowpaymentrequest", val: "true" },
                { key: "title", val: "bani-frame" + d(6) },
                {
                  key: "sandbox",
                  val: "allow-forms allow-scripts allow-same-origin allow-top-navigation-by-user-activation allow-popups",
                },
              ].forEach(({ key: e, val: t }) => n.setAttribute(e, t)),
              n
            );
          })(e)),
          document.getElementById(p) || s.appendChild(h);
        const f = document.getElementById(p);
        (() => {
          ((e) => {
            document.head.querySelector(`style#${y}`) ||
              (((r = document.createElement("style")).type = "text/css"),
              (r.id = y),
              c.appendChild(r)),
              r.sheet.insertRule(e, r.length);
          })(
            "\n        @keyframes spin { \n           0% {\n            transform: rotate(0deg);\n           }\n          100% {\n            transform: rotate(360deg);\n          }\n        }\n      "
          );
          var e = document.createElement("div");
          if (
            ((e.id = m),
            (e.style =
              "position:fixed; top:64px; left:0px; right:0px; margin: 0px auto; z-index: 999999999; border: 2.5px solid #E1E1E1;  border-top: 2.5px solid #5444F2;  border-radius: 50%; width: 62px; height: 62px; animation: spin 2s linear infinite;"),
            document.getElementById(u))
          )
            return;
          const t = document.createElement("IFRAME");
          [
            {
              key: "style",
              val: "z-index: 999999999; background: rgba(0, 0, 0, 0.46); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 0px none transparent; overflow: hidden; margin: 0px; padding: 0px; -webkit-tap-highlight-color: transparent; position: fixed; left: 0px; top: 0px; width: 100%; visibility: visible; height: 100%; display:block; transition: opacity 1s ease;",
            },
            { key: "id", val: u },
            { key: "allowfullscreen", val: "true" },
            { key: "title", val: "bani-loader-frame" + d(6) },
          ].forEach(({ key: e, val: n }) => t.setAttribute(e, n)),
            s.appendChild(t),
            s.appendChild(e);
        })(),
          (l = { ...e }),
          (o = e?.onClose),
          (a = e?.callback),
          (i = e?.onCustomerExists);
        const b = Object.keys(l);
        for (let e = 0; e < b.length; e++)
          "function" == typeof l[b[e]] && delete l[b[e]];
        f &&
          (f.onload = function () {
            f.contentWindow?.postMessage({ ...l, checkoutReady: !0 }, "*");
          });
      }),
      (async function () {
        window.addEventListener("message", f);
      })(),
      (window.BaniPopUp = (e) => t.init(e)),
      t
    );
  }
);
